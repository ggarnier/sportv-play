<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <title>Evoluindo a experiência web no SporTV Play com React</title>
    <meta name="description" content="Ao projetar a nova plataforma de vídeos ao vivo no SporTV Play durante as Olimpíadas de 2016, com foco em maior desempenho e resiliência, construímos uma nova interface web com React e outras técnicas modernas de desenvolvimento front-end">
    <meta name="author" content="Guilherme Garnier">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Custom styles -->
    <style>
      .reveal section img {
        border: 0;
        background-color: transparent;
        box-shadow: none;
      }
      .reveal li {
        word-break: break-word;
      }
    </style>

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
              <section data-markdown>
        <script type="text/template">
          # Evoluindo a experiência web no SporTV Play com React

## Guilherme Garnier

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Guilherme Garnier

## Globo.com

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Globosat Play](static/globosat-play-logo.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Canais](static/channels.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Arquitetura original](static/globosat-play-architecture.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Problemas

Componentes

![Components](static/globotv-ui-components.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Problemas

- Como padronizar?
- Como compartilhar?

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Sportv Play](static/sportv-play-logo.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Home](static/sportv-play-home-antiga.png)


        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Olimpíadas](static/logo-olimpiadas-rio-2016.jpg)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Oportunidade
- resolver problemas com componentes
  - atualização
  - padronização
  - compartilhamento
- rever a arquitetura

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Componentes

![Polymer](static/polymer.png)
![React](static/react.svg)
![Angular](static/angularjs.svg)
![Vue](static/vue.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![React](static/react.svg)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![React lifecycle](static/react-lifecycle.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Modelo declarativo

```js
// Declarativo, c/ jQuery
$("button").prop("disabled", true)

$("textarea").on("input", function() {
  if ($(this).val().length > 0) {
    $("button").prop("disabled", false)
  } else {
    $("button").prop("disabled", true)
  }
})
```

```js
// Imperativo, c/ React
class TweetBox extends Component {
  state = {
    text: ""
  }

  handleChange(event) {
    this.setState({ text: event.target.value })
  }

  render() {
    return (
      <div>
        <textarea onChange={this.handleChange}></textarea>
        <button disabled={this.state.text.length === 0}>Tweet</button>
      </div>
    )
  }
}
```

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![React components](static/react-components.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Globo Play](static/globo-play-home.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Arquitetura das APIs

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Without BFF](static/no-bff-architecture.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Problemas

- Muitas APIs internas
- Muitas requisições
- Acoplamento entre apps antigas e novas

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Back-end for Front-end

![BFF](static/bff.png)

http://samnewman.io/patterns/architectural/bff/

http://philcalcado.com/2015/09/18/the_back_end_for_front_end_pattern_bff.html

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![With BFF](static/bff-architecture.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Vantagens

- APIs específicas
- Desacoplamento entre apps
- Otimização (menos requisições, payload menor)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Desvantagens

- duplicação de código
- duplicação de APIs

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Acoplamento

![BFF team ownership](static/bff-team-ownership.jpg)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Gerenciamento de estado

- usuário
- trial
- menu

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Redux](static/redux.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Redux data flow](static/redux-data-flow.jpg)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ```js
import { createStore } from 'redux'

// Create reducer
counter(state = 0, action) => {
  switch (action.type) {
  case 'INCREMENT':
    return state + 1
  case 'DECREMENT':
    return state - 1
  default:
    return state
  }
}

// Create store
let store = createStore(counter)

// React to store changes
store.subscribe(() =>
  console.log(store.getState())
)

// Dispatch actions
store.dispatch({ type: 'INCREMENT' }) // 1
store.dispatch({ type: 'INCREMENT' }) // 2
store.dispatch({ type: 'DECREMENT' }) // 1
```

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![MobX](static/mobx.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ```js
import {observable, autorun} from 'mobx'

const counter = observable(0)

autorun(() => console.log(counter.get()))

counter.set(counter.get() + 1) // 1
counter.set(counter.get() + 1) // 2
counter.set(counter.get() - 1) // 1
```

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![](static/you-might-not-need-redux.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          > "Redux offers a tradeoff..."

> "... if you’re just learning React, don’t make Redux your first choice."

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Arquitetura do CSS

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ```js
class HelloWorld extends Component {
  render() {
    const styles = {
      margin: "10px",
      color: "red"
    }
    return (
      <div style={styles}>
        Hello, world!
      </div>
    )
  }
}
```

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Thinking](static/meme-thinking.jpg)

# CSS inline?

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # CSS inline

## Problemas

- não permite cachear estilos (gera payload maior)
- não suporta pseudo classes (*:first*, *:hover*, *:last-child*)
- não suporta media queries
- não permite aplicar estilo em cascata
  - ex: **header img { border: "1px solid black" }**

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # CSS inline

## Vantagens

- não precisa realizar um request extra para o CSS
- isolamento
- facilita manutenção (evita código não usado)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # CSS in JS

```js
import disabledColor from "./constants"

class HelloWorld extends Component {
  state = {
    enabled: true
  }

  render() {
    const styles = {
      marginBottom: "5px",
      color: this.state.enabled ? "red" : disabledColor
    }

    return (
      <div style={styles}>
        Hello, world!
      </div>
    )
  }
}
```

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Radium](static/radium.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ```js
class Alert extends Component {
  getStyles() {
    const status = {
      notification: "#0074D9",
      success: "#27AE60",
      error: "#E74C3C"
    }

    return {
      alert: {
        position: "relative",
        width: "100%",
        padding: "5px",
        borderRadius: "3px",
        backgroundColor: status.notification,
        color: "white",
        textAlign: "center",
        fontFamily: "'Helvetica Neue', sans-serif",
        success: {
          backgroundColor: status.success
        },
        error: {
          backgroundColor: status.error
        },

        "@media (min-width: 320px)": {
          fontSize: "15px"
        }
      },
      closeButton: {
        position: "absolute",
        right: "10px",
        color: color(status[this.props.type]).lighten(0.2).hexString(),
        ":hover": {
          color: color(status[this.props.type]).lighten(0.5).hexString(),
          cursor: "pointer"
        }
      }
    }
  }
  render() {
    const styles = this.getStyles()
    return (
      <div style={[styles.alert, styles.alert[this.props.type]]}>
        { this.props.message }
        <span style={styles.closeButton}>&#x2715;</span>
      </div>
    )
  }
}
```

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Radium

## Problemas

- performance (pseudo classes e media queries resolvidos por JS)
- não resolve problema de estilos em cascata (*header img { ... }*)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Alternativas

- https://github.com/Khan/aphrodite
- CSS Modules
- CSS puro!

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Organização dos componentes

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          <div style="display: flex; align-items: center; justify-content: space-around">
  ![Signal list](static/signal-list.png)

  <div>
    <h2>Responsabilidades</h2>
    <ul style="margin: 40px 0 100px">
      <li>consumir dados (via API ou props)</li>
      <li>exibir dados</li>
    </ul>
  </div>
</div>

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Presentational & container components

Separação de responsabilidades

https://medium.com/@dan_abramov/smart-and-dumb-components-7ca2f9a7c7d0

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Container component

- recebe dados via API ou props
- formata dados
- repassa os dados para descendentes (presentational ou container)
- não tem conhecimento do markup

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ## entrada

```json
[{
    "title": "SporTV 3",
    "thumbUrl": "http://...",
    "schedule": [
      {
        "startsAt": "2017-04-17T11:30:00-03:00",
        "durationInMinutes": 120,
        "title": "Masters 1000",
        "description": "Monte Carlo",
        "live": true
      }, ...
    ]
  }, ...]
```

## saída

```json
[{
    "title": "SporTV 3",
    "description": "Masters 1000",
    "subDescription": "Monte Carlo",
    "thumbUrl": "http://...",
    "live": true
  }, ...]
```

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Presentational component

- markup
- estilo
- interações (clicks, eventos)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Vantagens

- componentes com menos responsabilidades
- facilita os testes
- facilita o compartilhamento

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Compartilhamento de componentes

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![Globo Play](static/globo-play-logo.png)

![](static/globo-play-menu.png)
![](static/globo-play-thumb.png)
![](static/globo-play-poster.png)
![](static/globo-play-offer.png)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ## Biblioteca para compartilhar componentes de vídeo

<div style="display: flex; align-items: center; justify-content: space-around">
  ![componentes](static/lib.png)

  <ul>
    <li>reaproveitar código</li>
    <li>trocar conhecimento entre times</li>
    <li>aproximar a experiência de uso dos produtos de vídeo</li>
  </ul>
</div>

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Problemas

- dependências dos componentes (Radium)
- forma de exportar componentes
  - transpilado ou não (ou ambos)
  - incluir dependências no bundle ou não
- interface dos componentes
- ownership (quem é responsável por um bug?)
- documentação (Atellier, Storybook)

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Otimizações

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Stateless components

https://hackernoon.com/react-stateless-functional-components-nine-wins-you-might-have-overlooked-997b0d933dbc

```js
const Footer = (props) => {
  return (
    <footer>
      <p>© 2017 Globo Comunicação e Participações S.A.</p>
      <a href={props.url}>Política de Privacidade</a>
    </footer>
  )
}
```

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Cachear callbacks

```js
class VideoList extends Component {
  thumbClick() {
    metrics.register(`click video-list #{this.props.name`)
  }

  render() {
    <VideoThumb title="video 1" onClick={this.thumbClick.bind(this)}>
    <VideoThumb title="video 2" onClick={this.thumbClick.bind(this)}>
  }
}
```

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Cachear callbacks

```js
const sum = (a, b) => a + b

const bind1 = sum.bind(this)
const bind2 = sum.bind(this)

bind1 == bind1 // false
bind1 == bind2 // false
```

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Cachear callbacks

```js
class Home extends Component {
  constructor() {
    this.thumbClickCallback = this.thumbClick.bind(this)
  }

  thumbClick() {
    metrics.register(`click video-list #{this.props.name`)
  }

  render() {
    <VideoThumb onClick={this.thumbClickCallback}>
  }
}
```

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Conclusão

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          ![React](static/react.svg)

- facilitou a criação de componentes
- maduro e evoluindo rapidamente
- ecossistema crescente
- gerenciamento de estado
  - MobX para aplicações menores
  - Redux para aplicações mais complexas
- arquitetura do CSS em discussão
- compartilhar componentes não é tão simples quanto parece

        </script>
      </section>

      <section data-markdown>
        <script type="text/template">
          # Perguntas?

        </script>
      </section>


			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
        width: 1280,
        height: 800,
        margin: 0.1,
        controls: false,
        progress: false,
        history: true,
        center: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
